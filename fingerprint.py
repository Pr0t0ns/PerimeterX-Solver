import random
import json
import time
import pytz
from datetime import datetime
import urllib.parse
from mods import fn, generate_pc

def fingerprint_1(host: str, uuid: str, st: int):
    return json.dumps(([{
        "t": "PX2",
        "d": {
            "PX96": host,
            "PX63": "Win32", 
            "PX191": 0, 
            "PX850": 0, 
            "PX851": random.randint(300, 700), 
            "PX1008": 3600,
            "PX1055": st, 
            "PX1056": st + random.randint(1, 50), 
            "PX1038": uuid, 
            "PX371": False
        }
    }]), separators=(",", ":"))

def fingerprint_2(payload_1: dict, response_1: dict, site_keys: dict) -> str:
    payload_1 = payload_1[0]['d']
    response_data = str(response_1['do'])
    return json.dumps(([
    {
        "t": "PX3",
        "d": {
            "PX234": False,
            "PX235": False,
            "PX151": False,
            "PX239": False,
            "PX240": False,
            "PX152": False,
            "PX153": False,
            "PX314": False,
            "PX192": False,
            "PX196": False,
            "PX207": False,
            "PX251": False,
            "PX982": int(response_data.split("sts|")[1].split("',")[0]),
            "PX983": response_data.split("cls|")[1].split("',")[0],
            f"{fn(response_data.split("cls|")[1].split("',")[0], int(response_data.split("sts|")[1].split("',")[0]) % 10 + 2)}": f"{fn(response_data.split("cls|")[1].split("',")[0], int(response_data.split("sts|")[1].split("',")[0]) % 10 + 1)}",
            "PX985": int(response_data.split("drc|")[1].split("',")[0]),
            "PX1033": "49e5084e",
            "PX1019": "1530fd3",
            "PX1020": "57b9b686",
            "PX1021": "180dd7e3",
            "PX1022": "6a90378d",
            "PX1035": True,
            "PX1139": False,
            "PX1025": False,
            "PX359": f"{generate_pc("Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36", payload_1['PX1038'], False)}",
            "PX943": response_data.split("wcs|")[1].split("',")[0],
            "PX357": f"{generate_pc("Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36", site_keys['vid'], False)}",
            "PX358": f"{generate_pc("Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36", site_keys['sid'], False)}",
            "PX229": 24,
            "PX230": 24,
            "PX91": 1280,
            "PX92": 800,
            "PX269": 1280,
            "PX270": 752,
            "PX93": "1280X800",
            "PX185": 665,
            "PX186": 252,
            "PX187": 0,
            "PX188": 0,
            "PX95": True,
            "PX400": 1441,
            "PX404": "109|66|66|70|80",
            "PX90": [
                "loadTimes",
                "csi",
                "app"
            ],
            "PX190": "",
            "PX552": "false",
            "PX399": "false",
            "PX549": 1,
            "PX411": 1,
            "PX405": True,
            "PX547": True,
            "PX134": True,
            "PX89": True,
            "PX170": 5,
            "PX85": [
                "PDF Viewer",
                "Chrome PDF Viewer",
                "Chromium PDF Viewer",
                "Microsoft Edge PDF Viewer",
                "WebKit built-in PDF"
            ],
            "PX1179": True,
            "PX1180": True,
            "PX59": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36",
            "PX61": "en-US",
            "PX313": [
                "en-US",
                "en"
            ],
            "PX63": payload_1['PX63'],
            "PX86": True,
            "PX154": 420,
            "PX1157": 8,
            "PX1173": 2,
            "PX133": True,
            "PX88": True,
            "PX169": 2,
            "PX62": "Gecko",
            "PX69": "20030107",
            "PX64": "5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36",
            "PX65": "Netscape",
            "PX66": "Mozilla",
            "PX1144": True,
            "PX1152": 1.45,
            "PX1153": 100,
            "PX1154": False,
            "PX1155": "4g",
            "PX60": True,
            "PX87": True,
            "PX821": 4294705152,
            "PX822": 21869834,
            "PX823": 18631122,
            "PX147": False,
            "PX155": f"{datetime.now(pytz.timezone('America/Los_Angeles')).strftime('%a %b %d %Y %H:%M:%S GMT%z')} (Pacific Daylight Time)",
            "PX236": False,
            "PX194": False,
            "PX195": True,
            "PX237": 10,
            "PX238": "missing",
            "PX208": "visible",
            "PX218": 0,
            "PX231": 752,
            "PX232": 1280,
            "PX254": False,
            "PX295": False,
            "PX268": False,
            "PX166": True,
            "PX138": False,
            "PX143": True,
            "PX1142": 8,
            "PX1143": 3,
            "PX1146": 0,
            "PX1147": 1,
            "PX714": "64556c77",
            "PX715": "",
            "PX724": "10207b2f",
            "PX725": "10207b2f",
            "PX729": "90e65465",
            "PX443": True,
            "PX466": True,
            "PX467": True,
            "PX468": True,
            "PX191": payload_1['PX191'],
            "PX94": 6,
            "PX120": [],
            "PX141": False,
            "PX96": payload_1['PX96'],
            "PX55": f"{urllib.parse.quote(str(payload_1['PX96']), safe='')}",
            "PX34": "Error\n    at Oe (https://static.airtable.com/js/lib/perimeterx/v1/PX0OZADU9K/init.js:3:10744)\n    at ye (https://static.airtable.com/js/lib/perimeterx/v1/PX0OZADU9K/init.js:3:1750)",
            "PX1065": 2,
            "PX850": payload_1['PX850'],
            "PX851": payload_1['PX851'],
            "PX1054": int(time.time()) * 1000,
            "PX1008": payload_1['PX1008'],
            "PX1055": payload_1['PX1055'],
            "PX1056": payload_1['PX1056'],
            "PX1038": payload_1['PX1038'],
            "PX371": payload_1['PX371']
        }
    }
]), separators=(",", ":")).replace(r"\n", "\\n").replace(r")\n", r")\\n").replace(r"r\n", r"r\\n").replace(r"Error\n", r"Error\\n")

